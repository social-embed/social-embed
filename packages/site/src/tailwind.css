@layer base, starlight, theme, components, utilities;

@import "@astrojs/starlight-tailwind";
@import "tailwindcss/theme.css" layer(theme);
@import "tailwindcss/utilities.css" layer(utilities);

/* Reroll button animations */
@keyframes spin-dice {
  from {
    transform: rotate(0deg) scale(1);
  }
  50% {
    transform: rotate(180deg) scale(1.2);
  }
  to {
    transform: rotate(360deg) scale(1);
  }
}

@keyframes bounce-pop {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.08);
  }
  100% {
    transform: scale(1);
  }
}

@theme {
  /* Font configuration using Astro's experimental fonts API */
  --font-mono: var(--font-ibm-plex-mono);
  --font-sans: var(--font-ibm-plex-sans);

  /* Define slate colors for use in dark mode */
  --color-slate-50: #f8fafc;
  --color-slate-100: #f1f5f9;
  --color-slate-200: #e2e8f0;
  --color-slate-300: #cbd5e1;
  --color-slate-400: #94a3b8;
  --color-slate-500: #64748b;
  --color-slate-600: #475569;
  --color-slate-700: #334155;
  --color-slate-800: #1e293b;
  --color-slate-900: #0f172a;
  --color-slate-950: #020617;

  /* Microviz OKLCH series colors - perceptually consistent palette */
  --color-mv-blue: oklch(0.65 0.15 250);
  --color-mv-teal: oklch(0.7 0.15 150);
  --color-mv-yellow: oklch(0.72 0.15 80);
  --color-mv-orange: oklch(0.72 0.12 30);
  --color-mv-red: oklch(0.68 0.14 10);
  --color-mv-purple: oklch(0.67 0.16 295);
  --color-mv-cyan: oklch(0.71 0.14 200);
  --color-mv-green: oklch(0.73 0.13 120);

  /* Light variants (for light mode backgrounds) */
  --color-mv-blue-light: color-mix(in oklch, oklch(0.65 0.15 250), white 80%);
  --color-mv-teal-light: color-mix(in oklch, oklch(0.7 0.15 150), white 80%);
  --color-mv-yellow-light: color-mix(in oklch, oklch(0.72 0.15 80), white 80%);
  --color-mv-orange-light: color-mix(in oklch, oklch(0.72 0.12 30), white 80%);
  --color-mv-red-light: color-mix(in oklch, oklch(0.68 0.14 10), white 80%);
  --color-mv-purple-light: color-mix(in oklch, oklch(0.67 0.16 295), white 80%);
  --color-mv-cyan-light: color-mix(in oklch, oklch(0.71 0.14 200), white 80%);
  --color-mv-green-light: color-mix(in oklch, oklch(0.73 0.13 120), white 80%);

  /* Dark variants (for dark mode backgrounds) */
  --color-mv-blue-dark: color-mix(in oklch, oklch(0.65 0.15 250), black 30%);
  --color-mv-teal-dark: color-mix(in oklch, oklch(0.7 0.15 150), black 30%);
  --color-mv-yellow-dark: color-mix(in oklch, oklch(0.72 0.15 80), black 30%);
  --color-mv-orange-dark: color-mix(in oklch, oklch(0.72 0.12 30), black 30%);
  --color-mv-red-dark: color-mix(in oklch, oklch(0.68 0.14 10), black 30%);
  --color-mv-purple-dark: color-mix(in oklch, oklch(0.67 0.16 295), black 30%);
  --color-mv-cyan-dark: color-mix(in oklch, oklch(0.71 0.14 200), black 30%);
  --color-mv-green-dark: color-mix(in oklch, oklch(0.73 0.13 120), black 30%);
}

/**
 * Core navigation variables - OUR source of truth.
 * Starlight's --sl-* variables inherit from these.
 */
:root {
  /* Navigation dimensions */
  --nav-height: 3.5rem;
  --nav-pad-x: 1rem;
  --nav-pad-y: 0.75rem;
  --nav-gap: 1rem;

  /* Navigation colors (dark mode default) */
  --nav-bg: rgba(15, 23, 42, 0.95); /* slate-900/95 */
  --nav-border: var(--color-slate-700);
  --nav-text: var(--color-slate-100);
  --nav-text-muted: var(--color-slate-400);

  /* Starlight inherits from our variables */
  --sl-nav-height: var(--nav-height);
  --sl-nav-pad-x: var(--nav-pad-x);
  --sl-nav-pad-y: var(--nav-pad-y);
  --sl-nav-gap: var(--nav-gap);
  --sl-color-bg-nav: var(--nav-bg);
}

[data-theme="light"] {
  --nav-bg: rgba(255, 255, 255, 0.95); /* white/95 */
  --nav-border: var(--color-slate-200);
  --nav-text: var(--color-slate-900);
  --nav-text-muted: var(--color-slate-600);
}

/* Target small displays like phones */
:root {
  --sl-content-width: 100%;
}

@media (min-width: 640px) {
  /* Target small displays like tablets */
  :root {
    --sl-content-width: calc(
      100% -
      (var(--sl-content-pad-x) * 2)
    ); /* Make it wider on small screens */
  }
}

@media (min-width: 1024px) {
  /* Target larger displays like desktops */
  :root {
    --sl-content-width: calc(100% - (var(--sl-content-pad-x) * 7));
  }
}

/** Content regions: More room on smaller displays */
.main-pane .sl-container {
  max-width: 100%;
  margin-inline: unset;
}

@media (min-width: 1024px) {
  .main-pane .sl-container {
    max-width: var(--sl-content-width);
    margin-inline: var(--sl-content-margin-inline, auto);
  }
}

/** <pre> Headers on READMEs **/
.sl-markdown-content :is(h1, h2, h3, h4, h5, h6) code {
  font-size: 40%; /* Base font size for extra-small screens (default) */
}

@media (min-width: 480px) {
  /* Target small displays like phones */
  .sl-markdown-content :is(h1, h2, h3, h4, h5, h6) code {
    font-size: 50%;
  }
}

@media (min-width: 640px) {
  /* Target medium displays like tablets */
  .sl-markdown-content :is(h1, h2, h3, h4, h5, h6) code {
    font-size: 70%;
  }
}

@media (min-width: 1024px) {
  /* Target larger displays like desktops */
  .sl-markdown-content :is(h1, h2, h3, h4, h5, h6) code {
    font-size: inherit; /* Default or larger font size */
  }
}

/** For code embeds on example pages **/
.sl-markdown-content :is(video, iframe):not(:where(.not-content *)) {
  height: revert-layer;
  min-height: 600px;
}

/* Fix iframe min-height inside .not-content widgets */
.not-content iframe {
  min-height: unset;
}

@layer utilities {
  /* Override gray colors with slate colors */
  :root {
    --sl-color-gray-1: var(--color-slate-200);
    --sl-color-gray-2: var(--color-slate-300);
    --sl-color-gray-3: var(--color-slate-400);
    --sl-color-gray-4: var(--color-slate-600);
    --sl-color-gray-5: var(--color-slate-700);
    --sl-color-gray-6: var(--color-slate-800);
    --sl-color-black: var(--color-slate-900);

    /* Override Starlight badge hues with microviz OKLCH colors */
    /* Dark mode (default): -low = dark bg, -high = light text */
    /* success variant uses cyan for "try it" badge */
    --sl-color-green: var(--color-mv-cyan);
    --sl-color-green-low: var(--color-mv-cyan-dark);
    --sl-color-green-high: var(--color-mv-cyan-light);

    --sl-color-blue: var(--color-mv-blue);
    --sl-color-blue-low: var(--color-mv-blue-dark);
    --sl-color-blue-high: var(--color-mv-blue-light);

    --sl-color-purple: var(--color-mv-purple);
    --sl-color-purple-low: var(--color-mv-purple-dark);
    --sl-color-purple-high: var(--color-mv-purple-light);

    --sl-color-orange: var(--color-mv-orange);
    --sl-color-orange-low: var(--color-mv-orange-dark);
    --sl-color-orange-high: var(--color-mv-orange-light);

    --sl-color-red: var(--color-mv-red);
    --sl-color-red-low: var(--color-mv-red-dark);
    --sl-color-red-high: var(--color-mv-red-light);
  }

  /* Preserve success badge styling when sidebar item is selected */
  .sidebar-content a[aria-current="page"] > .sl-badge.success {
    --sl-color-bg-badge: var(--sl-badge-success-bg);
    --sl-color-border-badge: var(--sl-badge-success-border);
    --sl-color-text-badge: var(--sl-badge-success-text);
    color: var(--sl-color-text-badge);
  }

  /* Light mode: -low = light bg, -high = dark text */
  [data-theme="light"] {
    --sl-color-green-low: var(--color-mv-cyan-light);
    --sl-color-green-high: var(--color-mv-cyan-dark);

    --sl-color-blue-low: var(--color-mv-blue-light);
    --sl-color-blue-high: var(--color-mv-blue-dark);

    --sl-color-purple-low: var(--color-mv-purple-light);
    --sl-color-purple-high: var(--color-mv-purple-dark);

    --sl-color-orange-low: var(--color-mv-orange-light);
    --sl-color-orange-high: var(--color-mv-orange-dark);

    --sl-color-red-low: var(--color-mv-red-light);
    --sl-color-red-high: var(--color-mv-red-dark);
  }

  /* Add backdrop blur to Starlight header to match homepage */
  header:has(.header) {
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
  }
}
