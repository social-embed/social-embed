---
id: examples
title: Examples
description: How to parse and embed various media URLs with @social-embed/lib
sidebar:
  order: 25
---

@social-embed/lib provides a type-safe, registry-based API for detecting and embedding media URLs. All parsing returns a `Result<T>` type for explicit error handling.

## Quick Overview

| API | Description |
|-----|-------------|
| `MatcherRegistry.withDefaults()` | Create a registry with all built-in matchers |
| `registry.match(url)` | Match a URL and get typed parse result |
| `registry.toEmbedUrl(url)` | Get the embed URL directly |
| `registry.toOutput(url, options)` | Get structured output for rendering |
| `defineIframeMatcher(config)` | Create a custom matcher |

---

## 1. Basic Usage

### Match and Embed a URL

```ts
import { MatcherRegistry } from "@social-embed/lib";

const registry = MatcherRegistry.withDefaults();

// Match a URL and get typed result
const result = registry.match("https://youtu.be/dQw4w9WgXcQ");

if (result.ok) {
  console.log(result.matcher.name);  // "YouTube"
  console.log(result.data);          // { id: "dQw4w9WgXcQ" }

  // Get the embed URL (privacy-enhanced by default)
  const embedUrl = result.matcher.toEmbedUrl(result.data);
  // => "https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ"
}
```

### Direct Embed URL Conversion

For simple cases where you just need the embed URL:

```ts
const registry = MatcherRegistry.withDefaults();

const embedUrl = registry.toEmbedUrl("https://youtu.be/dQw4w9WgXcQ");
// => "https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ"
```

### Get Structured Output

For SSR or custom rendering, use `toOutput()` to get structured data:

```ts
const result = registry.match("https://youtu.be/dQw4w9WgXcQ");

if (result.ok) {
  const output = result.matcher.toOutput(result.data, {
    width: 800,
    height: 450,
  });

  console.log(output);
  // {
  //   nodes: [{
  //     type: "iframe",
  //     src: "https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ",
  //     attributes: { width: "800", height: "450", ... }
  //   }]
  // }
}
```

---

## 2. Type-Safe Matching with `isMatch()`

When you need type-safe access to matcher-specific data, use `isMatch()`:

```ts
import { MatcherRegistry, YouTubeMatcher, SpotifyMatcher } from "@social-embed/lib";

const registry = MatcherRegistry.withDefaults();
const result = registry.match(url);

// Type guard narrows result to specific matcher
if (registry.isMatch(result, YouTubeMatcher)) {
  // TypeScript knows result.data is YouTubeData
  console.log(result.data.videoId);  // Fully typed!
}

if (registry.isMatch(result, SpotifyMatcher)) {
  // TypeScript knows result.data is SpotifyData
  console.log(result.data.contentType);  // "track", "album", etc.
  console.log(result.data.id);
}
```

This is especially useful when you need matcher-specific behavior:

```ts
const result = registry.match(userInput);

if (registry.isMatch(result, SpotifyMatcher)) {
  // Apply Spotify-specific options
  const output = result.matcher.toOutput(result.data, {
    size: "compact",
    theme: "dark",
  });
} else if (result.ok) {
  // Generic handling for other matchers
  const output = result.matcher.toOutput(result.data);
}
```

---

## 3. Privacy Mode

Privacy-enhanced mode is **enabled by default** for matchers that support it:

```ts
const registry = MatcherRegistry.withDefaults();

// Default: privacy enabled (uses youtube-nocookie.com)
registry.toEmbedUrl("https://youtu.be/abc123");
// => "https://www.youtube-nocookie.com/embed/abc123"

// Opt out of privacy mode
registry.toEmbedUrl("https://youtu.be/abc123", { privacy: false });
// => "https://www.youtube.com/embed/abc123"
```

Privacy mode is supported for:
- **YouTube**: Uses `youtube-nocookie.com` instead of `youtube.com`

---

## 4. Built-in Matchers

### YouTube

Supports standard, short, and embed URLs:

```ts
const registry = MatcherRegistry.withDefaults();

// Standard watch URL
registry.toEmbedUrl("https://www.youtube.com/watch?v=dQw4w9WgXcQ");

// Short URL
registry.toEmbedUrl("https://youtu.be/dQw4w9WgXcQ");

// Already an embed URL
registry.toEmbedUrl("https://www.youtube.com/embed/dQw4w9WgXcQ");

// All return: "https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ"
```

### Vimeo

```ts
registry.toEmbedUrl("https://vimeo.com/134668506");
// => "https://player.vimeo.com/video/134668506"

registry.toEmbedUrl("https://vimeo.com/channels/staffpicks/134668506");
// => "https://player.vimeo.com/video/134668506"
```

### Spotify

Supports tracks, albums, playlists, artists, shows, and episodes:

```ts
// Track
registry.toEmbedUrl("https://open.spotify.com/track/4iV5W9uYEdYUVa79Axb7Rh");
// => "https://open.spotify.com/embed/track/4iV5W9uYEdYUVa79Axb7Rh"

// Album
registry.toEmbedUrl("https://open.spotify.com/album/1DFixLWuPkv3KT3TnV35m3");
// => "https://open.spotify.com/embed/album/1DFixLWuPkv3KT3TnV35m3"

// Playlist
registry.toEmbedUrl("https://open.spotify.com/playlist/37i9dQZF1DXcBWIGoYBM5M");
// => "https://open.spotify.com/embed/playlist/37i9dQZF1DXcBWIGoYBM5M"

// Spotify URI format also works
registry.toEmbedUrl("spotify:track:4iV5W9uYEdYUVa79Axb7Rh");
// => "https://open.spotify.com/embed/track/4iV5W9uYEdYUVa79Axb7Rh"
```

### DailyMotion

```ts
registry.toEmbedUrl("https://www.dailymotion.com/video/x7znrd0");
// => "https://www.dailymotion.com/embed/video/x7znrd0"

registry.toEmbedUrl("https://dai.ly/x7znrd0");
// => "https://www.dailymotion.com/embed/video/x7znrd0"
```

### Loom

```ts
registry.toEmbedUrl("https://www.loom.com/share/e883f70b219a49f6ba7fbeac71a72604");
// => "https://www.loom.com/embed/e883f70b219a49f6ba7fbeac71a72604"
```

### Wistia

```ts
registry.toEmbedUrl("https://support.wistia.com/medias/26sk4lmiix");
// => "https://fast.wistia.net/embed/iframe/26sk4lmiix"
```

### EdPuzzle

```ts
registry.toEmbedUrl("https://edpuzzle.com/media/606b413369971e424ec6021e");
// => "https://edpuzzle.com/embed/media/606b413369971e424ec6021e"
```

---

## 5. Error Handling

All parsing operations return a `Result<T>` type for explicit error handling:

```ts
const result = registry.match("https://invalid-url.com");

if (!result.ok) {
  console.log(result.error.code);     // "NO_MATCH"
  console.log(result.error.message);  // "No matcher found for URL"
  console.log(result.error.fatal);    // false
}
```

### Error Codes

| Code | Description |
|------|-------------|
| `NO_MATCH` | No matcher recognized the URL |
| `INVALID_FORMAT` | URL matched but has invalid format |
| `MISSING_ID` | URL matched but couldn't extract ID |
| `PARSE_ERROR` | General parse failure |

### Handling Unknown URLs

```ts
const url = "https://example.com/some-video";
const result = registry.match(url);

if (result.ok) {
  // Known provider - use structured output
  const output = result.matcher.toOutput(result.data);
  renderEmbed(output);
} else {
  // Unknown URL - could render as a link or show error
  console.log(`Unsupported URL: ${url}`);
}
```

---

## 6. Custom Matchers

### Using `defineIframeMatcher` (Recommended)

For iframe-based embeds, use the factory function:

```ts
import { defineIframeMatcher, MatcherRegistry } from "@social-embed/lib";

const TikTokMatcher = defineIframeMatcher({
  name: "TikTok",
  domains: ["tiktok.com"],
  patterns: [/tiktok\.com\/@[\w]+\/video\/(\d+)/],
  embedUrl: (id) => `https://www.tiktok.com/embed/${id}`,
  defaultDimensions: { width: 325, height: 580 },
});

// Add to registry
const registry = MatcherRegistry.withDefaults().with(TikTokMatcher);

// Now works
registry.toEmbedUrl("https://www.tiktok.com/@user/video/1234567890");
// => "https://www.tiktok.com/embed/1234567890"
```

### Implementing UrlMatcher Directly

For complex matchers with multi-field data:

```ts
import type { UrlMatcher, MatchContext, Result, EmbedOutput } from "@social-embed/lib";
import { ok, noMatch, hostMatches } from "@social-embed/lib";

interface MyServiceData {
  id: string;
  type: "video" | "audio";
}

const MyServiceMatcher: UrlMatcher<"MyService", MyServiceData> = {
  name: "MyService",
  domains: ["myservice.example.com"],

  canMatch(ctx: MatchContext): boolean {
    return hostMatches(ctx, ["myservice.example.com"]);
  },

  parse(ctx: MatchContext): Result<MyServiceData> {
    const videoMatch = ctx.raw.match(/myservice\.example\.com\/video\/(\w+)/);
    if (videoMatch) {
      return ok({ id: videoMatch[1], type: "video" });
    }

    const audioMatch = ctx.raw.match(/myservice\.example\.com\/audio\/(\w+)/);
    if (audioMatch) {
      return ok({ id: audioMatch[1], type: "audio" });
    }

    return noMatch("No pattern matched");
  },

  toEmbedUrl(data: MyServiceData): string {
    return `https://myservice.example.com/embed/${data.type}/${data.id}`;
  },

  toOutput(data: MyServiceData, options): EmbedOutput {
    return {
      nodes: [{
        type: "iframe",
        src: this.toEmbedUrl(data),
        attributes: {
          width: String(options?.width ?? 640),
          height: String(options?.height ?? 360),
        },
      }],
    };
  },
};
```

---

## 7. Registry Patterns

### Create with Defaults

```ts
const registry = MatcherRegistry.withDefaults();
```

### Create with Subset

```ts
import { YouTubeMatcher, VimeoMatcher } from "@social-embed/lib";

const videoOnly = MatcherRegistry.create([YouTubeMatcher, VimeoMatcher]);
```

### Extend Immutably

```ts
const base = MatcherRegistry.withDefaults();
const extended = base.with(MyCustomMatcher);
// base is unchanged, extended has the new matcher
```

### Mutate at Runtime

```ts
const registry = MatcherRegistry.withDefaults();
registry.register(MyCustomMatcher);  // Modifies in place
```

### Register with Priority

Higher priority matchers are checked first, useful when overriding built-in behavior:

```ts
const registry = MatcherRegistry.withDefaults();

// Register with priority (higher = matches first)
registry.register(MyCustomMatcher, { priority: 10 });

// Override built-in YouTube with custom implementation
const CustomYouTubeMatcher = defineIframeMatcher({
  name: "CustomYouTube",
  domains: ["youtube.com", "youtu.be"],
  patterns: [/youtu\.be\/(\w+)/, /youtube\.com\/watch\?v=(\w+)/],
  embedUrl: (id) => `https://my-proxy.example.com/youtube/${id}`,
});

registry.register(CustomYouTubeMatcher, { priority: 100 });
// Now CustomYouTubeMatcher matches before the built-in YouTubeMatcher
```

### Remove Matchers

```ts
const registry = MatcherRegistry.withDefaults();
const noSpotify = registry.without("Spotify");
```

### Check Available Matchers

```ts
const registry = MatcherRegistry.withDefaults();

console.log(registry.list().map(m => m.name));
// ["YouTube", "Vimeo", "Spotify", "DailyMotion", "Loom", "Wistia", "EdPuzzle"]

console.log(registry.has("YouTube"));  // true
console.log(registry.get("YouTube"));  // YouTubeMatcher
```

---

## 8. SSR Usage

All core APIs are SSR-safe (no DOM dependencies):

```ts
// Works in Node.js, Deno, Bun, etc.
import { MatcherRegistry, renderOutput } from "@social-embed/lib";

const registry = MatcherRegistry.withDefaults();
const result = registry.match("https://youtu.be/abc123");

if (result.ok) {
  const output = result.matcher.toOutput(result.data, { width: 800 });
  const html = renderOutput(output);
  // => '<iframe src="https://www.youtube-nocookie.com/embed/abc123" width="800" height="315" ...></iframe>'
}
```

---

## Summary

- **Registry-based**: Use `MatcherRegistry.withDefaults()` as your entry point
- **Type-safe**: All operations return `Result<T>` for explicit error handling
- **Privacy-first**: YouTube uses `youtube-nocookie.com` by default
- **Extensible**: Add custom matchers with `defineIframeMatcher()` or implement `UrlMatcher` directly
- **SSR-safe**: All core APIs work without DOM

Check out the [Matchers documentation](/lib/providers/) for more details on the `UrlMatcher` interface.
